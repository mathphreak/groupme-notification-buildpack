#!/bin/bash

get_env() {
  if [[ -f $1/$2 ]]; then
    cat $1/$2
  else
    echo "       Environment variable $2 not found!" >&2
    exit 1
  fi
}

echo "-----> Sending GroupMe notification..."
sudo apt-get install -yy jq
bot_id=$(get_env $3 BUILD_GROUPME_BOT_ID)
gh_repo=$(get_env $3 BUILD_GITHUB_REPO)
commit_msg=$(curl https://api.github.com/repos/$gh_repo/commits/$SOURCE_VERSION | jq '.commit.message')
curl -X POST --data-urlencode "text=ü§ñüõ†Ô∏è Reporting for duty! Last update: $commit_msg" "https://api.groupme.com/v3/bots/post?bot_id=$bot_id"
